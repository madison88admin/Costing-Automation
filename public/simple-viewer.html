<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple File Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" integrity="sha512-r22gChDnGvBylk90+2e/ycr3RVrDi8DIOkIGNhJlKfuyQM2t0EX7jF+JqJ4e8x8w8Q2E5VkNalCqtl4PV4/VvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f0f2f5;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .upload {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            border: 2px dashed #bdc3c7;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }

        .upload.dragover {
            border-color: #27ae60;
            background: #d5f4e6;
        }

        .file-input {
            display: none;
        }

        .file-info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .file-info h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: bold;
            color: #7f8c8d;
        }

        .info-value {
            color: #2c3e50;
        }

        .content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            display: none;
        }

        .content h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .table th {
            background: #34495e;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }

        .table td {
            padding: 10px 12px;
            border-bottom: 1px solid #ecf0f1;
        }

        .table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .table tr:hover {
            background: #e3f2fd;
        }

        .text-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .image-content {
            text-align: center;
        }

        .image-content img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .pdf-content {
            text-align: center;
            padding: 40px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .pdf-icon {
            font-size: 4rem;
            color: #e74c3c;
            margin-bottom: 15px;
        }

        .message {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .message.success {
            background: #d5f4e6;
            color: #27ae60;
            border-left: 4px solid #27ae60;
        }

        .message.error {
            background: #fadbd8;
            color: #e74c3c;
            border-left: 4px solid #e74c3c;
        }

        .message.info {
            background: #d6eaf8;
            color: #3498db;
            border-left: 4px solid #3498db;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        .btn:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .controls {
            margin-bottom: 20px;
            display: none;
        }

        .search-box {
            width: 300px;
            padding: 8px 12px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            margin-right: 10px;
        }

        .search-box:focus {
            outline: none;
            border-color: #3498db;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .search-box {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .table {
                font-size: 12px;
            }
            
            .table th,
            .table td {
                padding: 8px 6px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìÑ Simple File Viewer</h1>
            <p>Upload any file to view its contents</p>
        </div>

        <div class="upload" id="uploadArea">
            <h3>üìÅ Choose a file to view</h3>
            <p>Click here or drag and drop a file</p>
            <input type="file" id="fileInput" class="file-input" accept="*/*">
        </div>

        <div id="fileInfo" class="file-info">
            <h3>üìã File Information</h3>
            <div id="fileDetails"></div>
        </div>

        <div id="controls" class="controls">
            <input type="text" id="searchBox" class="search-box" placeholder="Search content...">
            <button class="btn" onclick="exportData()">Export Data</button>
            <button class="btn btn-success" onclick="downloadFile()">Download File</button>
            <button class="btn btn-danger" onclick="clearViewer()">Clear</button>
        </div>

        <div id="content" class="content">
            <h3>üìä File Contents</h3>
            <div id="contentBody"></div>
        </div>

        <div id="messageArea"></div>
    </div>

    <script>
        let currentFile = null;
        let currentData = null;

        // File upload handling
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('dragleave', handleDragLeave);
        uploadArea.addEventListener('drop', handleDrop);
        fileInput.addEventListener('change', handleFileSelect);

        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                processFile(file);
            }
        }

        // File processing
        async function processFile(file) {
            currentFile = file;
            showMessage('info', `Processing ${file.name}...`);

            try {
                const fileType = getFileType(file);
                const data = await readFile(file, fileType);
                
                currentData = data;
                displayFileInfo(file, fileType);
                displayContent(data, fileType);
                showControls();
                
                showMessage('success', `File processed successfully!`);
            } catch (error) {
                console.error('Error processing file:', error);
                showMessage('error', `Error: ${error.message}`);
            }
        }

        function getFileType(file) {
            const extension = file.name.split('.').pop().toLowerCase();
            const mimeType = file.type;

            if (['xlsx', 'xls', 'xlsm'].includes(extension) || mimeType.includes('spreadsheet')) {
                return 'excel';
            } else if (extension === 'csv' || mimeType.includes('csv')) {
                return 'csv';
            } else if (['txt', 'log', 'md', 'json', 'xml', 'html', 'js', 'css', 'py', 'java', 'cpp', 'c'].includes(extension) || mimeType.includes('text')) {
                return 'text';
            } else if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(extension) || mimeType.includes('image')) {
                return 'image';
            } else if (extension === 'pdf' || mimeType.includes('pdf')) {
                return 'pdf';
            } else {
                return 'text';
            }
        }

        async function readFile(file, fileType) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        if (fileType === 'excel') {
                            resolve(readExcelFile(e.target.result));
                        } else if (fileType === 'csv') {
                            resolve(readCSVFile(e.target.result));
                        } else if (fileType === 'text') {
                            resolve(readTextFile(e.target.result));
                        } else if (fileType === 'image') {
                            resolve(readImageFile(e.target.result));
                        } else if (fileType === 'pdf') {
                            resolve(readPDFFile(file));
                        } else {
                            resolve(readTextFile(e.target.result));
                        }
                    } catch (error) {
                        reject(error);
                    }
                };
                
                reader.onerror = () => reject(new Error('Failed to read file'));
                
                if (fileType === 'excel') {
                    reader.readAsArrayBuffer(file);
                } else if (fileType === 'image' || fileType === 'pdf') {
                    reader.readAsDataURL(file);
                } else {
                    reader.readAsText(file);
                }
            });
        }

        function readExcelFile(data) {
            if (typeof XLSX === 'undefined') {
                throw new Error('XLSX library not loaded');
            }

            const workbook = XLSX.read(data, { type: 'array', raw: true });
            const result = [];

            workbook.SheetNames.forEach(sheetName => {
                const worksheet = workbook.Sheets[sheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: '' });
                result.push({
                    sheetName: sheetName,
                    data: jsonData
                });
            });

            return result;
        }

        function readCSVFile(text) {
            const lines = text.split(/\r?\n/);
            const data = lines.map(line => line.split(',').map(cell => cell.trim()));
            return [{ sheetName: 'CSV Data', data: data }];
        }

        function readTextFile(text) {
            return text;
        }

        function readImageFile(dataUrl) {
            return { type: 'image', url: dataUrl };
        }

        function readPDFFile(file) {
            return { 
                type: 'pdf', 
                fileName: file.name,
                fileSize: file.size
            };
        }

        // Display functions
        function displayFileInfo(file, fileType) {
            const fileInfo = document.getElementById('fileInfo');
            const fileDetails = document.getElementById('fileDetails');
            
            fileDetails.innerHTML = `
                <div class="info-row">
                    <span class="info-label">File Name:</span>
                    <span class="info-value">${file.name}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">File Type:</span>
                    <span class="info-value">${fileType.toUpperCase()}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">File Size:</span>
                    <span class="info-value">${(file.size / 1024).toFixed(2)} KB</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Last Modified:</span>
                    <span class="info-value">${new Date(file.lastModified).toLocaleString()}</span>
                </div>
            `;
            
            fileInfo.style.display = 'block';
        }

        function displayContent(data, fileType) {
            const content = document.getElementById('content');
            const contentBody = document.getElementById('contentBody');
            
            let html = '';
            
            if (fileType === 'image') {
                html = `
                    <div class="image-content">
                        <img src="${data.url}" alt="Image preview">
                    </div>
                `;
            } else if (fileType === 'pdf') {
                html = `
                    <div class="pdf-content">
                        <div class="pdf-icon">üìÑ</div>
                        <h3>PDF Document</h3>
                        <p>PDF files cannot be directly parsed in the browser.</p>
                        <p><strong>File:</strong> ${data.fileName}</p>
                        <p><strong>Size:</strong> ${(data.fileSize / 1024).toFixed(2)} KB</p>
                    </div>
                `;
            } else if (fileType === 'text') {
                html = `
                    <div class="text-content">${data}</div>
                `;
            } else {
                // Excel or CSV data
                data.forEach((sheet, index) => {
                    html += `<h4>üìä ${sheet.sheetName}</h4>`;
                    
                    if (sheet.data && sheet.data.length > 0) {
                        html += '<table class="table">';
                        
                        // Add headers
                        if (sheet.data[0] && sheet.data[0].length > 1) {
                            html += '<tr>';
                            for (let i = 0; i < sheet.data[0].length; i++) {
                                html += `<th>Column ${i + 1}</th>`;
                            }
                            html += '</tr>';
                        }
                        
                        // Add data rows (limit to 100 for performance)
                        const maxRows = Math.min(100, sheet.data.length);
                        for (let i = 0; i < maxRows; i++) {
                            const row = sheet.data[i];
                            html += '<tr>';
                            
                            if (Array.isArray(row)) {
                                row.forEach(cell => {
                                    const cellValue = cell !== null && cell !== undefined ? String(cell) : '';
                                    html += `<td title="${cellValue}">${cellValue}</td>`;
                                });
                            } else {
                                html += `<td colspan="10">${row}</td>`;
                            }
                            html += '</tr>';
                        }
                        
                        html += '</table>';
                        
                        if (sheet.data.length > 100) {
                            html += `<p style="text-align: center; color: #7f8c8d; margin-top: 10px;">Showing first 100 rows of ${sheet.data.length} total rows</p>`;
                        }
                    } else {
                        html += '<p>No data found in this sheet</p>';
                    }
                });
            }
            
            contentBody.innerHTML = html;
            content.style.display = 'block';
        }

        function showControls() {
            document.getElementById('controls').style.display = 'block';
        }

        function showMessage(type, message) {
            const messageArea = document.getElementById('messageArea');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            
            messageArea.innerHTML = `<div class="message ${className}">${message}</div>`;
            
            if (type === 'success' || type === 'info') {
                setTimeout(() => {
                    messageArea.innerHTML = '';
                }, 3000);
            }
        }

        // Control functions
        function exportData() {
            if (!currentData) {
                showMessage('error', 'No data to export');
                return;
            }

            if (Array.isArray(currentData)) {
                // Excel/CSV data
                const csvContent = currentData.map(sheet => {
                    if (sheet.data && sheet.data.length > 0) {
                        return sheet.data.map(row => 
                            Array.isArray(row) ? row.join(',') : row
                        ).join('\n');
                    }
                    return '';
                }).join('\n\n');
                
                downloadFile(csvContent, 'export.csv', 'text/csv');
            } else {
                // Text data
                downloadFile(currentData, 'export.txt', 'text/plain');
            }
            
            showMessage('success', 'Data exported successfully!');
        }

        function downloadFile() {
            if (!currentFile) {
                showMessage('error', 'No file to download');
                return;
            }

            const url = URL.createObjectURL(currentFile);
            const link = document.createElement('a');
            link.href = url;
            link.download = currentFile.name;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showMessage('success', 'File downloaded successfully!');
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function clearViewer() {
            currentFile = null;
            currentData = null;
            
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('controls').style.display = 'none';
            document.getElementById('content').style.display = 'none';
            document.getElementById('fileInput').value = '';
            
            showMessage('success', 'Viewer cleared successfully!');
        }

        // Search functionality
        document.getElementById('searchBox').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const contentBody = document.getElementById('contentBody');
            
            if (searchTerm === '') {
                // Reset to original content
                if (currentData) {
                    displayContent(currentData, getFileType(currentFile));
                }
                return;
            }
            
            // Simple search implementation
            const content = contentBody.innerHTML;
            const highlightedContent = content.replace(
                new RegExp(`(${searchTerm})`, 'gi'),
                '<mark style="background: yellow;">$1</mark>'
            );
            
            contentBody.innerHTML = highlightedContent;
        });

        // Demo function
        window.demoSimpleViewer = function() {
            console.log('üé¨ DEMO: Simple File Viewer');
            console.log('==========================');
            console.log('This is a simple, clean file viewer!');
            console.log('Features:');
            console.log('- Drag & drop file upload');
            console.log('- Simple, clean interface');
            console.log('- Support for all file types');
            console.log('- Search functionality');
            console.log('- Export and download options');
            console.log('- Mobile responsive');
            console.log('');
            console.log('üí° Try uploading a file to see it in action!');
        };
    </script>
</body>
</html>
